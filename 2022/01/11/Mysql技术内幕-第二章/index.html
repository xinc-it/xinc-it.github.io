<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Mysql技术内幕-第二章 | 无♥部落阁</title><meta name="keywords" content="数据库,Mysql,InnoDB"><meta name="author" content="无♥"><meta name="copyright" content="无♥"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="referrer" content="no-referrer"><meta name="description" content="1. InnoDB 体系架构 1. InnoDB 存储引擎作用 缓存磁盘上的数据，方便快速读取。对磁盘数据修改之前也做缓存。 redo log 缓冲 维护进程、线程需要访问的多个内部数据结构  1. 后台线程InnoDB 存储引擎是多线程模型，负责处理不同的任务 1. MasterThread作用将数据异步刷新到磁盘。其中包括脏页刷新、合并插入缓冲、UNDO 页回收。 2. IO Thread1"><meta property="og:type" content="article"><meta property="og:title" content="Mysql技术内幕-第二章"><meta property="og:url" content="https://xinc-it.github.io/2022/01/11/Mysql%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95-%E7%AC%AC%E4%BA%8C%E7%AB%A0/index.html"><meta property="og:site_name" content="无♥部落阁"><meta property="og:description" content="1. InnoDB 体系架构 1. InnoDB 存储引擎作用 缓存磁盘上的数据，方便快速读取。对磁盘数据修改之前也做缓存。 redo log 缓冲 维护进程、线程需要访问的多个内部数据结构  1. 后台线程InnoDB 存储引擎是多线程模型，负责处理不同的任务 1. MasterThread作用将数据异步刷新到磁盘。其中包括脏页刷新、合并插入缓冲、UNDO 页回收。 2. IO Thread1"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://gitee.com/xincao20/picgo-gitee/raw/master//img/b3f6b2565c3149a2a8df94ab43cf3a3b.jpg"><meta property="article:published_time" content="2022-01-11T20:55:45.000Z"><meta property="article:modified_time" content="2023-02-12T22:01:36.184Z"><meta property="article:author" content="无♥"><meta property="article:tag" content="数据库"><meta property="article:tag" content="Mysql"><meta property="article:tag" content="InnoDB"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://gitee.com/xincao20/picgo-gitee/raw/master//img/b3f6b2565c3149a2a8df94ab43cf3a3b.jpg"><link rel="shortcut icon" href="https://gitee.com/xincao20/picgo-gitee/raw/master//img/icon.webp"><link rel="canonical" href="https://xinc-it.github.io/2022/01/11/Mysql%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95-%E7%AC%AC%E4%BA%8C%E7%AB%A0/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://unpkg.zhimg.com/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://unpkg.zhimg.com/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:200},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#121212",position:"top-right"},source:{jQuery:"https://unpkg.zhimg.com/jquery@latest/dist/jquery.min.js",justifiedGallery:{js:"https://unpkg.zhimg.com/justifiedGallery/dist/js/jquery.justifiedGallery.min.js",css:"https://unpkg.zhimg.com/justifiedGallery/dist/css/justifiedGallery.min.css"},fancybox:{js:"https://unpkg.zhimg.com/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js",css:"https://unpkg.zhimg.com/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isanchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Mysql技术内幕-第二章",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-02-12 22:01:36"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));const n=()=>{GLOBAL_CONFIG_SITE.isHome&&/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")};n(),document.addEventListener("pjax:complete",n)})(window)</script><link rel="stylesheet" href="/css/custom/icon.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="/css/custom/background.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-clock/lib/clock.min.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload='this.media="all"'><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="无♥部落阁" type="application/atom+xml"></head><body><a href="javascript:void(0);" onclick="preloader.endLoading()" title="点击跳过动画"></a><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://gitee.com/xincao20/picgo-gitee/raw/master//img/icon.webp" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首頁</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i> <span>文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment"><i class="fa-fw fa fa-paper-plane"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fas fa-heart"></i> <span>关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://gitee.com/xincao20/picgo-gitee/raw/master//img/b3f6b2565c3149a2a8df94ab43cf3a3b.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">无♥部落阁</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首頁</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i> <span>文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment"><i class="fa-fw fa fa-paper-plane"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fas fa-heart"></i> <span>关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Mysql技术内幕-第二章</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-11T20:55:45.000Z" title="发表于 2022-01-11 20:55:45">2022-01-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-02-12T22:01:36.184Z" title="更新于 2023-02-12 22:01:36">2023-02-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>6分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="Mysql技术内幕-第二章"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><img src="https://cdn.nlark.com/yuque/0/2021/jpeg/12394516/1636370551211-b7e3691e-760d-4777-9125-49a114a0f304.jpeg"></p><h1 id="1-InnoDB-体系架构"><a href="#1-InnoDB-体系架构" class="headerlink" title="1. InnoDB 体系架构"></a>1. InnoDB 体系架构</h1><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12394516/1635692260786-270228fe-31a7-4258-b9c1-87c52f516e08.png#averageHue=%23f1f1f1&clientId=u2d86973c-b20b-4&from=paste&height=227&id=ua9f959a7&name=image.png&originHeight=454&originWidth=736&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30916&status=done&style=none&taskId=u899d9abe-da7d-4e86-8256-0126b55682e&title=&width=368" alt="image.png"></p><h3 id="1-InnoDB-存储引擎作用"><a href="#1-InnoDB-存储引擎作用" class="headerlink" title="1. InnoDB 存储引擎作用"></a>1. InnoDB 存储引擎作用</h3><ol><li><strong>缓存磁盘上的数据</strong>，方便快速读取。对<strong>磁盘数据修改之前也做缓存。</strong></li><li><strong>redo log 缓冲</strong></li><li>维护进程、线程需要访问的多个内部数据结构</li></ol><h3><a href="#" class="headerlink"></a></h3><h2 id="1-后台线程"><a href="#1-后台线程" class="headerlink" title="1. 后台线程"></a>1. 后台线程</h2><p>InnoDB 存储引擎是多线程模型，负责处理不同的任务</p><h3 id="1-MasterThread"><a href="#1-MasterThread" class="headerlink" title="1. MasterThread"></a>1. MasterThread</h3><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>将数据异步刷新到磁盘。其中包括脏页刷新、合并插入缓冲、UNDO 页回收。</p><h3 id="2-IO-Thread"><a href="#2-IO-Thread" class="headerlink" title="2. IO Thread"></a>2. IO Thread</h3><h4 id="1-作用"><a href="#1-作用" class="headerlink" title="1. 作用"></a>1. 作用</h4><p>InnoDB 使用了大量的<strong>异步 IO</strong> 来处理 IO 请求。作用是<strong>提高数据库的性能</strong>。<br>IO Thread 的作用是负责<strong>IO 请求的回调处理</strong></p><h4 id="2-分类"><a href="#2-分类" class="headerlink" title="2. 分类"></a>2. 分类</h4><p>IOThread 主要分为 4 种</p><ul><li><code>write thread</code>(默认 4 个)</li><li><code>read thread</code>(默认 4 个)</li><li><code>insert buffer thread</code></li><li><code>log io thread</code></li></ul><p>write 和 read Thread 可以通过 <code>innnodb_read_io_threads</code> 和<code>innodb_write_io_threads</code>设置线程数</p><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12394516/1635693324015-367ec145-45e4-4614-87a4-0c8acb2a6e1e.png#averageHue=%23dedede&clientId=u2d86973c-b20b-4&from=paste&height=101&id=u0203448e&name=image.png&originHeight=201&originWidth=916&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44417&status=done&style=none&taskId=u5737c692-8eaa-4bca-becf-305455ba63f&title=&width=458" alt="image.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//可以通过该命令查看innodb 中的io Thread</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">show engine innodb  status ;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12394516/1635693491056-13f94aba-301d-4a04-a8fa-9002fa135a97.png#averageHue=%23181512&clientId=u2d86973c-b20b-4&from=paste&height=118&id=u0f6a553d&name=image.png&originHeight=235&originWidth=567&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29125&status=done&style=none&taskId=u2646bf68-d485-4625-a513-b5ea7fdc815&title=&width=283.5" alt="image.png"></p><h3 id="3-Purge-Thread"><a href="#3-Purge-Thread" class="headerlink" title="3. Purge Thread"></a>3. Purge Thread</h3><h4 id="-1"><a href="#-1" class="headerlink"></a></h4><p><strong>作用：回收事务提交后的使用的 undo 页</strong>。<br>分配到独立的线程中进行，减少 Master Thread 工作。同时用户可以也可以通过<code>innnodb_purge_threads</code> 设置线程数，默认为 1.</p><h3 id="4-Page-Cleaner-Thread"><a href="#4-Page-Cleaner-Thread" class="headerlink" title="4. Page Cleaner Thread"></a>4. Page Cleaner Thread</h3><p>作用：脏页刷新操作。<br>从而减少了 Master Thread 工作和查询线程线程的阻塞。提高了 InnoDB 性能。</p><h3 id="5-后台线程作用"><a href="#5-后台线程作用" class="headerlink" title="5. 后台线程作用"></a>5. 后台线程作用</h3><ol><li>刷新内存池中的数据，保证缓存的是最新的数据</li><li>将已修改的数据文件刷新到磁盘中</li><li>保证数据库发生异常恢复正常</li></ol><h2 id="2-内存"><a href="#2-内存" class="headerlink" title="2. 内存"></a>2. 内存</h2><h3 id="-2"><a href="#-2" class="headerlink"></a></h3><h3 id="1-缓冲池"><a href="#1-缓冲池" class="headerlink" title="1. 缓冲池"></a>1. 缓冲池</h3><h4 id="1-作用-1"><a href="#1-作用-1" class="headerlink" title="1. 作用"></a>1. 作用</h4><p>用来<strong>解决 cpu 速度和磁盘速度之间的鸿沟</strong></p><h4 id="2-执行流程"><a href="#2-执行流程" class="headerlink" title="2. 执行流程"></a>2. 执行流程</h4><p>数据库读取页时，将磁盘读取到的页放在缓冲池中。下一次再次读取该数据页时，直接从池中读取。否则从磁盘上读取。</p><p>数据库修改页操作时，首先修改缓冲池的页，然后通过<code>check point</code> 机制将数据页刷新到磁盘中。</p><h4 id="3-缓冲池大小配置"><a href="#3-缓冲池大小配置" class="headerlink" title="3. 缓冲池大小配置"></a>3. 缓冲池大小配置</h4><p>通过 innnodb_buffer_pool_size 来设置缓冲池大小。</p><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12394516/1635694963515-e0b21fec-317a-400c-ac75-263527738b5a.png#averageHue=%2312100f&clientId=u2d86973c-b20b-4&from=paste&height=74&id=u4b5d0c0c&name=image.png&originHeight=147&originWidth=588&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10538&status=done&style=none&taskId=u89b99578-855f-48e2-a253-4720f96a6fb&title=&width=294" alt="image.png"></p><h4 id="4-存储对象"><a href="#4-存储对象" class="headerlink" title="4. 存储对象"></a>4. 存储对象</h4><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12394516/1635695049116-4482036d-9fb4-4114-86c0-d6bc26b0bb12.png#averageHue=%23eaeaea&clientId=u2d86973c-b20b-4&from=paste&height=170&id=ua8111efd&name=image.png&originHeight=339&originWidth=782&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36170&status=done&style=none&taskId=ud1cc8c94-5846-4f28-9046-31ccee4f486&title=&width=391" alt="image.png"></p><ol><li>索引页</li><li>数据页</li><li>插入缓冲</li><li>undo 页</li><li>自适应哈希索引</li><li>锁信息</li><li>数据字典信息</li></ol><h3 id="2-缓存算法"><a href="#2-缓存算法" class="headerlink" title="2. 缓存算法"></a>2. 缓存算法</h3><h4 id="1-LRU（最近最少使用淘汰）"><a href="#1-LRU（最近最少使用淘汰）" class="headerlink" title="1. LRU（最近最少使用淘汰）"></a>1. LRU（最近最少使用淘汰）</h4><p>将经常使用的页放在 LRU 列表的最前端，最少使用页放在列表尾端。将新读取的页放到 midpoint 位置（距离尾端的 3/8 出）。可以通过<code>innodb_old_blocks_pct</code>控制插入位置。<br><code>midpoint</code> 之前的 new 列表，之后的为 old 列表。new 列表中数据为活跃的数据。</p><p>为什么不直接把读取的新页放在列表首部？</p><p>部分 sql 操作（索引、数据扫描操作）导致缓冲池中页被刷出，影响缓冲池效率。需要读入大量的数据页，导致许多活跃数据页从列表中移除。<br>innodb 可以通过设置<code>innodb_old_blocks_time</code>来决定新加入的页从 mid 到列表头部需要等待多久。</p><h3 id="3-redo-日志缓冲（-redo-log-buffer）"><a href="#3-redo-日志缓冲（-redo-log-buffer）" class="headerlink" title="3. redo 日志缓冲（ redo log buffer）"></a>3. redo 日志缓冲（ redo log buffer）</h3><p>用于暂时存放 redo log 信息，然后 Innodb 以一定频率刷新到 redo log 文件中。<br>可以通过 <code>innnodb_log_buffer_size</code>设置缓冲大小。</p><p><strong>三种日志刷新到 redo log 文件情况</strong></p><ol><li>Master Thread 每秒刷新</li><li>事务提交时刷新</li><li>日志缓冲空间小于一半</li></ol><h1 id="2-Checkpoint-技术"><a href="#2-Checkpoint-技术" class="headerlink" title="2. Checkpoint 技术"></a>2. Checkpoint 技术</h1><p><strong>解决问题</strong></p><ol><li>缩短数据恢复时间</li><li>缓冲池不够时，将脏页刷新到磁盘</li><li>redo log 日志缓冲不够时，刷新脏页</li></ol><h2 id="1-Check-Point-分类："><a href="#1-Check-Point-分类：" class="headerlink" title="1. Check Point 分类："></a>1. Check Point 分类：</h2><ol><li>Sharp Checkpoint</li><li>Fuzzy Checkpoing</li></ol><h2 id="2-Sharp-Checkpoint"><a href="#2-Sharp-Checkpoint" class="headerlink" title="2. Sharp Checkpoint"></a>2. Sharp Checkpoint</h2><p>默认将<strong>数据库关闭时将所有脏页刷新到磁盘中</strong>，<br>参数是 innodb_fast_shutdown=1.</p><h2 id="3-Fuzzy-Checkpoint"><a href="#3-Fuzzy-Checkpoint" class="headerlink" title="3. Fuzzy Checkpoint"></a>3. Fuzzy Checkpoint</h2><h3 id="1-Master-Thread-checkpoint"><a href="#1-Master-Thread-checkpoint" class="headerlink" title="1. Master Thread checkpoint"></a>1. Master Thread checkpoint</h3><p>每 1 或 10 秒将缓冲池中的部分脏页异步刷新到磁盘</p><h3 id="2-Async-Sync-Flush-checkpoint"><a href="#2-Async-Sync-Flush-checkpoint" class="headerlink" title="2. Async/Sync Flush checkpoint"></a>2. Async/Sync Flush checkpoint</h3><p>在重做日志不可用情况下强制刷新一部分页会磁盘。</p><h1 id="3-InnoDB-关键特性"><a href="#3-InnoDB-关键特性" class="headerlink" title="3. InnoDB 关键特性"></a>3. InnoDB 关键特性</h1><h2 id="1-插入缓冲"><a href="#1-插入缓冲" class="headerlink" title="1. 插入缓冲"></a>1. 插入缓冲</h2><h3 id="1-Insert-Buffer"><a href="#1-Insert-Buffer" class="headerlink" title="1. Insert Buffer"></a>1. Insert Buffer</h3><p>原理： 当对<strong>非聚集索</strong>引进<strong>行插入或更新</strong>操作时，若<strong>索引页在缓冲池</strong>中，则直接<strong>更新索引页</strong>。反之，先<strong>放到 Insert Buffer <strong>中，然后以一定频率将 Insert Buffer 中的数据和辅助索引页进行</strong>merge 操作</strong>。</p><p>前提：<strong>不是唯一索引的辅助索引</strong><br>问题：为什么不能是唯一索引？<br>因为唯一索引在更新时，需要将索引页加载进缓冲池中，判断索引是否唯一。将索引页加入了缓冲池中，就失去了使用 Insert Buffer 的意义。<br>作用：提高插入性能，因为每次插入时不需要立即将数据 merge 到索引页中。</p><p>本质：将非聚集索引的写操作缓冲起来，然后将写操作批量 merge 到索引页中。</p><p>缺点：写密集情况下会暂用大量缓冲池内存<br>可以通过 IBUF_POOL_SIZE_PER_MAX_SIZE 设置 Insert buffer 占缓冲池的比例</p><h3 id="2-change-buffer"><a href="#2-change-buffer" class="headerlink" title="2. change buffer"></a>2. change buffer</h3><p>insert buffer 的升级版，支持 insert 、delete、 update 语句缓冲。通过 Insert Buffer、 Delete Buffer 、Purge Buffer 来实现缓冲。</p><p>Update 语句的实现过程</p><ol><li>数据的记录标记为删除</li><li>数据真正删除</li></ol><p>将数据记录标记位删除通过，通过 Delete Buffer 来实现。然后通过 Purge Buffer 将数据真正删除。</p><h3 id="3-Insert-Buffer-内部实现"><a href="#3-Insert-Buffer-内部实现" class="headerlink" title="3. Insert Buffer 内部实现"></a>3. Insert Buffer 内部实现</h3><p>Insert Buffer 的数据结构是一颗 B+树。<br>非叶节点存放的查询的 search key .<br><img src="https://cdn.nlark.com/yuque/0/2021/png/12394516/1635779623534-a1a111a7-ba6f-4e06-9b28-2805adb882e1.png#averageHue=%23eeeeee&clientId=u147b5b0d-e61f-4&from=paste&height=51&id=u23ae932e&name=image.png&originHeight=102&originWidth=545&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7625&status=done&style=none&taskId=u8a8fadad-c07e-4ea8-a65f-6252e61e696&title=&width=272.5" alt="image.png"></p><ul><li>space 表示数据插入的表的<strong>表空间 id（用于确定插入数据是哪张表）</strong></li><li>marker 兼容老版本的 Insert Buffer</li><li>offset 数据页在表中的偏移量（位置）（用于确定是辅助索引的哪一页）</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12394516/1635780351139-02db6f9a-d6eb-43b8-b2c3-006e96cac8da.png#averageHue=%23eeeded&clientId=u147b5b0d-e61f-4&from=paste&height=74&id=u85fb66e2&name=image.png&originHeight=147&originWidth=742&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20005&status=done&style=none&taskId=uf11cb2c4-21ca-4099-a07a-63bd4da678e&title=&width=371" alt="image.png"></p><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12394516/1635780853424-d8b9a379-1c69-4fdb-bcb0-b7b93b0b0a50.png#averageHue=%23ececec&clientId=u147b5b0d-e61f-4&from=paste&height=86&id=u6590f1f8&name=image.png&originHeight=172&originWidth=968&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15357&status=done&style=none&taskId=ud2fa6c63-6633-4abc-92bb-c812946d476&title=&width=484" alt="image.png"></p><p>metadata 中记录信息插入的顺序以及插入信息的类型</p><p>Insert Buffer 通过 space 和 offset 确定更新数据的表和辅助索引具体页。</p><h3 id="4-Merge-Insert-Buffer"><a href="#4-Merge-Insert-Buffer" class="headerlink" title="4. Merge Insert Buffer"></a>4. Merge Insert Buffer</h3><h5 id="-3"><a href="#-3" class="headerlink"></a></h5><ol><li>辅助索引页读取到缓冲池中</li><li>Insert Buffer Bitmap 页发现辅助索引页无可用空间时。</li><li>Master Thread 定时进行 Merge</li></ol><h3 id="4-命令"><a href="#4-命令" class="headerlink" title="4. 命令"></a>4. 命令</h3><h4 id="1-innodb-change-buffering"><a href="#1-innodb-change-buffering" class="headerlink" title="1. innodb_change_buffering"></a>1. <code>innodb_change_buffering</code></h4><p>作用： 选择开启哪些缓冲，参数为<img src="https://cdn.nlark.com/yuque/0/2021/png/12394516/1635779173141-60283c22-3b4a-4307-9afb-d2b31f2ecf19.png#averageHue=%23e4e4e4&clientId=u147b5b0d-e61f-4&from=paste&height=21&id=u50f1346f&name=image.png&originHeight=41&originWidth=472&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3875&status=done&style=none&taskId=uf0bc3b34-e529-4b4e-91b5-9d2fc61f89c&title=&width=236" alt="image.png"></p><h4 id="2-innodb-change-buffer-max-size"><a href="#2-innodb-change-buffer-max-size" class="headerlink" title="2. innodb_change_buffer_max_size"></a>2. innodb_change_buffer_max_size</h4><p>作用：控制 change buffer 最大内存使用量<br><img src="https://cdn.nlark.com/yuque/0/2021/png/12394516/1635779232140-aea89c5b-1c60-420c-ad21-7455d07c85ef.png#averageHue=%23dfdfdf&clientId=u147b5b0d-e61f-4&from=paste&height=23&id=ubfd3b6b4&name=image.png&originHeight=45&originWidth=880&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9395&status=done&style=none&taskId=u5e544fdf-c639-4141-8cea-ffb33be97fc&title=&width=440" alt="image.png"><br><strong>最大值为 50.</strong></p><h2 id="2-两次写"><a href="#2-两次写" class="headerlink" title="2. 两次写"></a>2. 两次写</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12394516/1636031467126-3252bdd4-ab40-4f6e-9266-86cd36868636.png#averageHue=%23d3e9eb&clientId=uecbbc78a-62fa-4&from=paste&height=255&id=u11158e89&name=image.png&originHeight=510&originWidth=816&originalType=binary&ratio=1&rotation=0&showTitle=false&size=174039&status=done&style=none&taskId=ueb092f1b-bb82-4392-9efa-7d478b9f7a8&title=&width=408" alt="image.png"></p><h3 id="1-流程"><a href="#1-流程" class="headerlink" title="1. 流程"></a>1. 流程</h3><ol><li>InnoDB 将脏页写到内存中的 Double write buffer 中</li><li>然后 DWB 将数据现在写入磁盘上 DWB</li><li>内存中的 DWB 再将数据刷到磁盘中</li></ol><h3 id="2-作用"><a href="#2-作用" class="headerlink" title="2. 作用"></a>2. 作用</h3><p>通过将脏页数据进行缓存，可以保证数据库异常关闭的情况下，脏页数据未完全写入磁盘时，无法通过 redo log 进行数据的恢复。可以通过 DWB 中之前保存的脏页数据，将数据页写入到磁盘中，然后 redo log 根据脏页进行数据的恢复。</p><p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/743889?spm=a2c6h.14164896.0.0.7d52783blX00fB">double write buffer 深度</a></p><h2 id="3-自适应哈希索引（AHI）"><a href="#3-自适应哈希索引（AHI）" class="headerlink" title="3. 自适应哈希索引（AHI）"></a>3. 自适应哈希索引（AHI）</h2><h3 id="1-概念"><a href="#1-概念" class="headerlink" title="1. 概念"></a>1. 概念</h3><p>由于哈希是一种时间复杂度为 O(1)的查找方法。可以通过在 B+树种建立哈希索引提高查询速度。</p><p>自适应哈希索引：存储引擎通过监控索引页的查询条件和频率，来选择是否建立哈希索引。<br>原理：通过缓冲池中的页</p><h3 id="2-前提"><a href="#2-前提" class="headerlink" title="2. 前提"></a>2. 前提</h3><ol><li>连续使用的查询条件一样</li><li>查询条件使用了 100 次</li><li>数据页通过该查询条件访问了（页中记录/16）次。</li></ol><h3 id="3-优缺点"><a href="#3-优缺点" class="headerlink" title="3. 优缺点"></a>3. 优缺点</h3><ol><li>提高了读取和写入速度</li><li>只能用来等值查询，不能范围查询</li></ol><h2 id="4-异步-IO"><a href="#4-异步-IO" class="headerlink" title="4. 异步 IO"></a>4. 异步 IO</h2><h3 id="1-作用-2"><a href="#1-作用-2" class="headerlink" title="1. 作用"></a>1. 作用</h3><ol><li>异步执行 IO 操作</li><li>IO 合并</li></ol><h3 id="2-异步-IO-操作"><a href="#2-异步-IO-操作" class="headerlink" title="2. 异步 IO 操作"></a>2. 异步 IO 操作</h3><p>同步 IO: 用户发出 IO 请求后，需要等待 IO 请求完成，才能继续发送下一个 IO 请求。<br>异步 IO: 用户发出 IO 请求后不需要等待 IO 操作完成，可以继续发出 IO 请求。直到所有的 IO 请求发送完后，等待 IO 操作完成。</p><h3 id="3-IO-合并"><a href="#3-IO-合并" class="headerlink" title="3. IO 合并"></a>3. IO 合并</h3><p>AIO:将多个 IO 请求合并为一个 IO 请求。</p><p>例如： 用户需要访问多个连续页时（8,6）、（8,7）、（8,8）可以将多个 IO 操作合并成一个 IO 操作。</p><p>（page,offset）指代某个表的某一页。</p><h2 id="5-刷新临接页"><a href="#5-刷新临接页" class="headerlink" title="5. 刷新临接页"></a>5. 刷新临接页</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12394516/1636369637440-accdf8fa-3eba-4dfa-a7bd-ca3a30b7af22.png#averageHue=%2398b5b8&clientId=udb988001-8bfa-4&from=paste&height=285&id=u6fd4ce86&name=image.png&originHeight=569&originWidth=1027&originalType=binary&ratio=1&rotation=0&showTitle=false&size=95537&status=done&style=none&taskId=u91c37abd-0f4c-4431-84d0-0657b3bb723&title=&width=513.5" alt="image.png"></p><p>工作原理：刷新脏页时，会检测所在区的所有分页，然后通过 AIO 一起进行刷新。</p><p>建议机械硬盘开启特性，固态硬盘由于有着高性能的 IO 读写可以关闭。</p><h1 id="-4"><a href="#-4" class="headerlink"></a></h1><h3 id="-5"><a href="#-5" class="headerlink"></a></h3></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined">无♥</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://xinc-it.github.io/2022/01/11/Mysql%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95-%E7%AC%AC%E4%BA%8C%E7%AB%A0/">https://xinc-it.github.io/2022/01/11/Mysql%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95-%E7%AC%AC%E4%BA%8C%E7%AB%A0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://xinc-it.github.io" target="_blank">无♥部落阁</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><a class="post-meta__tags" href="/tags/Mysql/">Mysql</a><a class="post-meta__tags" href="/tags/InnoDB/">InnoDB</a></div><div class="post_share"><div class="social-share" data-image="https://gitee.com/xincao20/picgo-gitee/raw/master//img/b3f6b2565c3149a2a8df94ab43cf3a3b.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://unpkg.zhimg.com/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://unpkg.zhimg.com/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/01/11/1!%E4%BA%86%E8%A7%A3Mysql%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/"><img class="prev-cover" src="https://gitee.com/xincao20/picgo-gitee/raw/master//img/2c09c340e57a4963ba60fdc0d809db8b.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">了解Mysql查询语句执行流程</div></div></a></div><div class="next-post pull-right"><a href="/2021/12/24/Java%E6%97%A5%E6%9C%9F%E5%B8%B8%E7%94%A8%E7%B1%BB/"><img class="next-cover" src="https://gitee.com/xincao20/picgo-gitee/raw/master//img/d45ef0bf880411ebb6edd017c2d2eca2.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Java日期常用类</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/01/11/1!%E4%BA%86%E8%A7%A3Mysql%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/" title="了解Mysql查询语句执行流程"><img class="cover" src="https://gitee.com/xincao20/picgo-gitee/raw/master//img/2c09c340e57a4963ba60fdc0d809db8b.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-11</div><div class="title">了解Mysql查询语句执行流程</div></div></a></div><div><a href="/2022/09/06/2!%E6%9B%B4%E6%96%B0%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C/" title="Mysql-更新语句的执行"><img class="cover" src="https://gitee.com/xincao20/picgo-gitee/raw/master//img/6f1ed4d5882611ebb6edd017c2d2eca2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-06</div><div class="title">Mysql-更新语句的执行</div></div></a></div><div><a href="/2022/09/07/3!%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB/" title="Mysql-事务隔离"><img class="cover" src="https://gitee.com/xincao20/picgo-gitee/raw/master//img/e1418f513cc84fb68518f605c4e63c8c.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-07</div><div class="title">Mysql-事务隔离</div></div></a></div><div><a href="/2022/09/09/4!%E7%B4%A2%E5%BC%95/" title="Mysql-索引"><img class="cover" src="https://gitee.com/xincao20/picgo-gitee/raw/master//img/604caf7f880511ebb6edd017c2d2eca2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-09</div><div class="title">Mysql-索引</div></div></a></div><div><a href="/2021/09/10/5!%E9%94%81/" title="Mysql-锁"><img class="cover" src="https://gitee.com/xincao20/picgo-gitee/raw/master//img/27524ac7880511ebb6edd017c2d2eca2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-10</div><div class="title">Mysql-锁</div></div></a></div><div><a href="/2022/09/11/6!%E8%A1%8C%E9%94%81/" title="Mysql-行锁"><img class="cover" src="https://gitee.com/xincao20/picgo-gitee/raw/master//img/914f5f5f882d11ebb6edd017c2d2eca2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-11</div><div class="title">Mysql-行锁</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-InnoDB-%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84"><span class="toc-text">1. InnoDB 体系架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-InnoDB-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E4%BD%9C%E7%94%A8"><span class="toc-text">1. InnoDB 存储引擎作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%90%8E%E5%8F%B0%E7%BA%BF%E7%A8%8B"><span class="toc-text">1. 后台线程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-MasterThread"><span class="toc-text">1. MasterThread</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-text">作用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-IO-Thread"><span class="toc-text">2. IO Thread</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BD%9C%E7%94%A8"><span class="toc-text">1. 作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%86%E7%B1%BB"><span class="toc-text">2. 分类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Purge-Thread"><span class="toc-text">3. Purge Thread</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-1"><span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Page-Cleaner-Thread"><span class="toc-text">4. Page Cleaner Thread</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%90%8E%E5%8F%B0%E7%BA%BF%E7%A8%8B%E4%BD%9C%E7%94%A8"><span class="toc-text">5. 后台线程作用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%86%85%E5%AD%98"><span class="toc-text">2. 内存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-2"><span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BC%93%E5%86%B2%E6%B1%A0"><span class="toc-text">1. 缓冲池</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BD%9C%E7%94%A8-1"><span class="toc-text">1. 作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-text">2. 执行流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BC%93%E5%86%B2%E6%B1%A0%E5%A4%A7%E5%B0%8F%E9%85%8D%E7%BD%AE"><span class="toc-text">3. 缓冲池大小配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1"><span class="toc-text">4. 存储对象</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BC%93%E5%AD%98%E7%AE%97%E6%B3%95"><span class="toc-text">2. 缓存算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-LRU%EF%BC%88%E6%9C%80%E8%BF%91%E6%9C%80%E5%B0%91%E4%BD%BF%E7%94%A8%E6%B7%98%E6%B1%B0%EF%BC%89"><span class="toc-text">1. LRU（最近最少使用淘汰）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-redo-%E6%97%A5%E5%BF%97%E7%BC%93%E5%86%B2%EF%BC%88-redo-log-buffer%EF%BC%89"><span class="toc-text">3. redo 日志缓冲（ redo log buffer）</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Checkpoint-%E6%8A%80%E6%9C%AF"><span class="toc-text">2. Checkpoint 技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Check-Point-%E5%88%86%E7%B1%BB%EF%BC%9A"><span class="toc-text">1. Check Point 分类：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Sharp-Checkpoint"><span class="toc-text">2. Sharp Checkpoint</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Fuzzy-Checkpoint"><span class="toc-text">3. Fuzzy Checkpoint</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Master-Thread-checkpoint"><span class="toc-text">1. Master Thread checkpoint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Async-Sync-Flush-checkpoint"><span class="toc-text">2. Async&#x2F;Sync Flush checkpoint</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-InnoDB-%E5%85%B3%E9%94%AE%E7%89%B9%E6%80%A7"><span class="toc-text">3. InnoDB 关键特性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%8F%92%E5%85%A5%E7%BC%93%E5%86%B2"><span class="toc-text">1. 插入缓冲</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Insert-Buffer"><span class="toc-text">1. Insert Buffer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-change-buffer"><span class="toc-text">2. change buffer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Insert-Buffer-%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0"><span class="toc-text">3. Insert Buffer 内部实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Merge-Insert-Buffer"><span class="toc-text">4. Merge Insert Buffer</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#-3"><span class="toc-text"></span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%91%BD%E4%BB%A4"><span class="toc-text">4. 命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-innodb-change-buffering"><span class="toc-text">1. innodb_change_buffering</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-innodb-change-buffer-max-size"><span class="toc-text">2. innodb_change_buffer_max_size</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%B8%A4%E6%AC%A1%E5%86%99"><span class="toc-text">2. 两次写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%B5%81%E7%A8%8B"><span class="toc-text">1. 流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BD%9C%E7%94%A8"><span class="toc-text">2. 作用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%87%AA%E9%80%82%E5%BA%94%E5%93%88%E5%B8%8C%E7%B4%A2%E5%BC%95%EF%BC%88AHI%EF%BC%89"><span class="toc-text">3. 自适应哈希索引（AHI）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A6%82%E5%BF%B5"><span class="toc-text">1. 概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%89%8D%E6%8F%90"><span class="toc-text">2. 前提</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">3. 优缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%BC%82%E6%AD%A5-IO"><span class="toc-text">4. 异步 IO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BD%9C%E7%94%A8-2"><span class="toc-text">1. 作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%BC%82%E6%AD%A5-IO-%E6%93%8D%E4%BD%9C"><span class="toc-text">2. 异步 IO 操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-IO-%E5%90%88%E5%B9%B6"><span class="toc-text">3. IO 合并</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%88%B7%E6%96%B0%E4%B8%B4%E6%8E%A5%E9%A1%B5"><span class="toc-text">5. 刷新临接页</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-4"><span class="toc-text"></span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-5"><span class="toc-text"></span></a></li></ol></li></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2023 By 无♥</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://unpkg.zhimg.com/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script async>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading()),setTimeout((function(){preloader.endLoading()}),5e3)</script><div class="js-pjax"><script>function loadValine(){function e(){new Valine(Object.assign({el:"#vcomment",appId:"idgEEVWTyzLG7NwvF6xqQNTk-gzGzoHsz",appKey:"DwL0OWPlF6lEUBsU1bDzqqdp",placeholder:"Please leave your footprints p",avatar:"monsterid",meta:"nick,mail,link".split(","),pageSize:"10",lang:"zh-CN",recordIP:!0,serverURLs:"",emojiCDN:"",emojiMaps:"",enableQQ:!0,path:window.location.pathname,requiredFields:["nick,mail"],visitor:!1},null))}"function"==typeof Valine?e():getScript("https://unpkg.zhimg.com/valine/dist/Valine.min.js").then(e)}{function loadOtherComment(){loadValine()}btf.loadComment(document.getElementById("vcomment"),loadValine)}</script></div><script media="defer" src="/js/custom/custom.js"></script><div class="aplayer no-destroy" data-id="3206381615" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><script id="click-heart" src="https://unpkg.zhimg.com/butterfly-extsrc@1/dist/click-heart.min.js" async mobile="false"></script><link rel="stylesheet" href="https://unpkg.zhimg.com/aplayer/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://unpkg.zhimg.com/aplayer/dist/APlayer.min.js"></script><script src="/js/custom/Meting.min.js"></script><script src="https://unpkg.zhimg.com/pjax/pjax.min.js"></script><script>let pjaxSelectors=["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(window.removeEventListener("scroll",window.tocScrollFn),window.removeEventListener("scroll",scrollCollect),"object"==typeof preloader&&preloader.initLoading(),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach(e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll(),"object"==typeof preloader&&preloader.endLoading()})),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script data-pjax>function butterfly_clock_injector_config(){var i=document.getElementsByClassName("sticky_layout")[0];console.log("已挂载butterfly_clock"),i.insertAdjacentHTML("afterbegin",'<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="http://img.wuxin.website/img/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>')}for(var elist="null".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_clock_injector_config()</script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://unpkg.zhimg.com/hexo-butterfly-clock/lib/clock.min.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>function gitcalendar_injector_config(){document.getElementById("recent-posts").insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>'),console.log("已挂载gitcalendar")}document.getElementById("recent-posts")&&"/"===location.pathname&&(gitcalendar_injector_config(),GitCalendarInit("https://github-calendar-lyart.vercel.app/api?xinc-it",["#ebedf0","#fdcdec","#fc9bd9","#fa6ac5","#f838b2","#f5089f","#c4067e","#92055e","#540336","#48022f","#30021f"],"xinc-it"))</script></body></html>